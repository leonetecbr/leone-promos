function igShare(e){let t=$(e).find(".product-title").html(),o=$(e).find(".description").html(),n=$(e).find("del").html(),i=$(e).find(".code-text").val();$("#product-title").html(t),$("#product-image").attr("src",$(e).find(".product-image").attr("src")),$("#product-image").attr("alt",t),void 0!==n?($("#product-price-from").html(n),$("#price-from").show()):$("#price-from").hide(),$("#installment").html($(e).find(".installment").html()),void 0!==o?($("#product-desc").html(o),$("#product-desc").show()):$("#product-desc").hide(),void 0!==i?$("#product-code").show():$("#product-code").hide(),$("#product-price-to").html($(e).find(".pricing-card-title").html()),$("#share-link").html(getUrl(e)),$("#ig-share").removeClass("d-none")}function getText(e){let t=$(e).find(".description").html(),o=$(e).find(".pricing-card-title").html(),n=$(e).find("del").html();return"Grátis"!==o&&(o=`Por apenas: ${o}`),void 0!==n&&(o=`De: ${n}\n\n${o}`),o=`${$(e).find(".product-title").html()}.\n\n${o}!`,void 0!==t&&(o+=`\n\n${t}`),o}function getTextCupom(e){let t=$(e).find(".card-title").html()+" no(a) "+$(e).find(".loja-image").attr("alt"),o=$(e).find(".cupom-vigency").html(),n=String($(e).find(".code-text").val()),i=n.substring(0,n.length-2);return n="Cupom: "+i.replace(/\w/g,"*")+n.substr(-2),t+=`\n\n${o}\n\n${n}`,t}function getUrl(e){return"https://para.promo/"+btoa(e.replace("#promo-","o-"))}function getUrlCupom(e){return"https://para.promo/"+btoa(e.replace("#cupom-","c-"))}function accept(){createCookie("accept","true",365),$("#aviso_cookie").fadeOut("slow")}function copyText(e,t=!1){navigator.clipboard.writeText(e).then((()=>{t?window.open(t):($("#copy-success").removeClass("d-none"),setTimeout((()=>$("#copy-success").addClass("d-none")),3e3))}),(()=>{alert("Não foi possível copiar, copie manualmente!"),t&&window.open(t)}))}function topo(){$("html, body").animate({scrollTop:0},800)}function submit(){let e=getCSRF();$("#checkbox").append(e),$("#checkbox").trigger("submit")}function getCSRF(){let e=document.createElement("input");return e.setAttribute("type","hidden"),e.id="token",e.setAttribute("name","_token"),e.value=CSRF,e}function getReCaptcha(e){let t=document.createElement("input");return t.setAttribute("type","hidden"),t.id="g-recaptcha-response",t.setAttribute("name","g-recaptcha-response"),t.value=e,t}function createCookie(e,t,o){let n;if(o){let e=new Date;e.setTime(e.getTime()+24*o*60*60*1e3),n="; expires="+e.toGMTString()}else n="";document.cookie=`${e}=${t}${n}; path=/`}function deleteCookie(e){createCookie(e,"",-1)}function getPrefer(e){$.ajax({url:"/prefer/get",data:JSON.stringify({endpoint:e,_token:CSRF}),dataType:"json",contentType:"application/json",type:"POST"}).done((e=>{if(e.success){let t=0;for(let o=0;o<e.pref.length;o++)e.pref[o]&&($("#p"+(o+1)).attr("checked",!0),t++);t==e.pref.length&&$("#all").attr("checked",!0),$("#preferencias").removeClass("d-none")}else null!=typeof e.message?alert(e.message):alert("Falha")})).fail((()=>{alert("Falha")}))}function redirectUrl(){let e=$("#url").val();e=e.strstr("?"),window.open(`/redirect?url=${e}`),$("#url").val("")}function pesquisar(e,t){let o=getCSRF(),n=getReCaptcha(t),i=document.createElement("form");i.setAttribute("method","POST"),i.setAttribute("action",`/search/${e}`),i.id="pesquisar",i.appendChild(o),i.appendChild(n),$("body").append(i),$("#pesquisar").trigger("submit")}function paginateSearch(e,t){let o=getCSRF(),n=getReCaptcha(t),i=document.createElement("form");i.setAttribute("method","POST"),i.setAttribute("action",`${e}`),i.id="pesquisar",i.appendChild(o),i.appendChild(n),$("body").append(i),$("#pesquisar").trigger("submit")}function sendForm(e,t){let o=new Object;for(let t of $(`#${e}`).serializeArray())o[t.name]=t.value;o._token=CSRF,o["g-recaptcha-response"]=t;let n=$(`#${e}-submit`).html(),i=$(`#${e}-submit`),s=`#error-${e}`;i.attr("disabled",!0),i.html("Aguarde ..."),$(`#${e}`).removeClass("was-validated"),$(s).addClass("d-none"),$.ajax({url:$(`#${e}`).attr("action"),data:JSON.stringify(o),dataType:"json",contentType:"application/json",type:"POST"}).done((function(e){void 0===typeof e.success?($(s).html('<p class="alert alert-danger">Erro desconhecido :(</p>'),$(s).removeClass("d-none")):void 0!==typeof e.message&&(e.success?($(s).html('<div class="alert alert-success">'+e.message+"</div>"),$(s).removeClass("d-none")):($(s).html('<p class="alert alert-danger">'+e.message+"</p>"),$(s).removeClass("d-none")))})).fail((()=>{$(s).html('<p class="alert alert-danger">Não foi possível enviar os dados, tente novamente!</p>'),$(s).removeClass("d-none")})).always((()=>{i.html(n),i.attr("disabled",!1)}))}function getToken(e,t,o="ajax"){grecaptcha.ready((()=>{grecaptcha.execute(KEY_V3_RECAPTCHA,{action:e}).then((e=>{if("ajax"===o)sendForm(t,e);else if("search"===o){pesquisar($("#q").val(),e)}else"paginate"===o&&paginateSearch(t,e)}))}))}String.prototype.strstr=function(e){let t=this.indexOf(e);return-1==t?this:this.substring(0,t)},$((function(){$(".ajax-form").on("submit",(function(e){this.checkValidity()?(e.preventDefault(),getToken($(this).attr("data-action"),this.id)):(e.preventDefault(),e.stopPropagation()),this.classList.add("was-validated")})),$(".needs-validation").on("submit",(function(e){!1===this.checkValidity()?(e.preventDefault(),e.stopPropagation(),$(this).addClass("was-validated")):(e.preventDefault(),$(this).addClass("was-validated"),"deeplink"==this.id&&redirectUrl(),$(this).removeClass("was-validated"))})),navigator.share&&$(".plus-share").removeClass("d-none"),$(".igs").on("click",(function(){alert("Tire print e compartilhe nas suas storys, para fechar dê um duplo clique!"),igShare("#"+$(this).closest(".promo").attr("id"))})),$(".mre").on("click",(function(){let e,t,o;void 0!==$(this).closest(".promo").attr("id")?(t="#"+$(this).closest(".promo").attr("id"),e=getText(t)+"\n",o=getUrl(t)):(t="#"+$(this).closest(".cupom").attr("id"),e=getTextCupom(t)+"\n",o=getUrlCupom(t)),navigator.share({text:e,url:o})})),$(".cpy").on("click",(function(){let e,t,o;void 0!==$(this).closest(".promo").attr("id")?(t="#"+$(this).closest(".promo").attr("id"),e=getText(t),o=getUrl(t)):(t="#"+$(this).closest(".cupom").attr("id"),e=getTextCupom(t),o=getUrlCupom(t)),e+=`\n\n${o}`,copyText(e)})),$(".wpp").on("click",(function(){let e,t,o;void 0!==$(this).closest(".promo").attr("id")?(t="#"+$(this).closest(".promo").attr("id"),e=getText(t),o=getUrl(t)):(t="#"+$(this).closest(".cupom").attr("id"),e=getTextCupom(t),o=getUrlCupom(t)),e+=`\n\n${o}`,window.open("https://api.whatsapp.com/send?text="+encodeURIComponent(e))})),$(".tlg").on("click",(function(){let e,t,o;void 0!==$(this).closest(".promo").attr("id")?(t="#"+$(this).closest(".promo").attr("id"),e="\n"+getText(t),o=getUrl(t)):(t="#"+$(this).closest(".cupom").attr("id"),e="\n"+getTextCupom(t),o=getUrlCupom(t)),window.open("https://telegram.me/share/url?url="+encodeURIComponent(o)+"&text="+encodeURIComponent(e))})),$(".twt").on("click",(function(){let e,t,o;void 0!==$(this).closest(".promo").attr("id")?(t="#"+$(this).closest(".promo").attr("id"),e=getText(t)+"\n\n",o=getUrl(t)):(t="#"+$(this).closest(".cupom").attr("id"),e=getTextCupom(t)+"\n\n",o=getUrlCupom(t)),window.open("https://twitter.com/share?url="+encodeURIComponent(o)+"&text="+encodeURIComponent(e))})),$("#ig-share").on("dbclick",(function(){$(this).addClass("d-none")})),$(".copy-redirect").on("click",(function(){let e=$(this).closest(".promo").attr("id");e=void 0===e?"#"+$(this).closest(".cupom").attr("id"):"#"+e;let t=$(this).attr("data-link");copyText($(e).find(".code-text").val(),t)})),$(window).on("scroll",(function(){let e=$("#cabecalho");$(this).scrollTop()>90?(e.addClass("fixed-top"),e.addClass("shadow"),$("body").css("padding-top",90)):(e.removeClass("fixed-top"),e.removeClass("shadow"),$("body").css("padding-top",0))})),$("#inotify").on("click",(function(){$("#notify").addClass("d-none"),createCookie("no_notify",1,60)})),0==window.location.pathname.indexOf("/search")&&($(".page-link").on("click",(function(e){e.preventDefault(),getToken("paginate",$(this).attr("href"),"paginate")})),$(".filtros").on("click",(function(e){e.preventDefault(),getToken("paginate",$(this).attr("href"),"paginate")}))),$("#prefers input[type='checkbox']").on("change",(function(){$("#prefers input[type='checkbox']").is(":checked")?($("#para").attr("disabled",!0),$("#para").removeAttr("required")):($("#para").attr("disabled",!1),$("#para").attr("required"))})),$("#all").on("change",(function(){$(".prefer").prop("checked",$(this).is(":checked"))})),$(".prefer").on("change",(function(){let e=!0;for(check of $(".prefer"))$(check).is(":checked")||(e=!1);$("#all").prop("checked",e)})),$("#btn-topo").on("click",topo)}));let sub,isSubscribed=!1,swRegistration=null,btn=$("#btn-notify");function urlB64ToUint8Array(e){const t=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),o=window.atob(t),n=new Uint8Array(o.length);for(let e=0;e<o.length;++e)n[e]=o.charCodeAt(e);return n}function initializeUI(){document.cookie.indexOf("no_notify")<0&&$("#notify").removeClass("d-none"),btn.attr("disabled",!1),btn.on("click",(()=>{btn.attr("disabled",!0),btn.html("Aguarde ..."),isSubscribed?unsubscribeUser():subscribeUser()})),swRegistration.pushManager.getSubscription().then((e=>{if(sub=e,isSubscribed=!(null===e),isSubscribed)"/notificacoes"===window.location.pathname?(getPrefer(e.endpoint),$("#endpoint").val(e.endpoint)):"/"===window.location.pathname&&document.cookie.indexOf("no_update")<0&&update("update");else if("granted"===Notification.permission&&document.cookie.indexOf("no_resubscribe")<0){const e=urlB64ToUint8Array(KEY_VAPID_PUBLIC);swRegistration.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:e}).then((e=>{sub=e,update("update")})).catch((()=>console.log("Falha na reativação das notificações")))}updateBtn()}))}function updateBtn(){if("denied"===Notification.permission)return $("#btn-notify").html("Notificações bloqueadas"),$("#btn-notify").attr("disabled",!0),$("#notify-bloqued").removeClass("d-none"),void(sub&&update("remove"));btn.attr("disabled",!1),isSubscribed?(setTimeout((()=>{createCookie("no_notify",1,60),$("#notify").hide("slow")}),1e3),btn.html("Desativar notificações")):btn.html("Ativar notificações")}function subscribeUser(){deleteCookie("no_resubscribe");const e=urlB64ToUint8Array(KEY_VAPID_PUBLIC);swRegistration.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:e}).then((e=>{sub=e,update("add")})).catch((()=>updateBtn()))}function unsubscribeUser(){createCookie("no_resubscribe",1,365),sub?(sub.unsubscribe(),isSubscribed=!1,update("remove"),$("#preferencias").addClass("d-none")):updateBtn()}function update(e){grecaptcha.ready((()=>{grecaptcha.execute(KEY_V3_RECAPTCHA,{action:"notify"}).then((t=>{const o={subscription:sub,action:e,token:t,_token:CSRF};$.ajax({url:"/notificacoes/manage",type:"POST",data:JSON.stringify(o),dataType:"json",contentType:"application/json",success:t=>{processResponse(t,e)}}).fail((()=>($("#notify").append('<p class="erro mt-2 center">Erro desconhecido!</p>'),sub&&(sub.unsubscribe(),isSubscribed=!1),updateBtn())))}))}))}function processResponse(e,t){if("update"!==t)return void 0===typeof e.success?($("#notify").append('<p class="erro mt-2 center">Erro desconhecido!</p>'),sub&&(sub.unsubscribe(),isSubscribed=!1)):e.success&&"add"===t?isSubscribed=!0:e.success&&"remove"===t?isSubscribed=!1:void 0!==typeof e.erro?($("#notify").append('<p class="erro mt-2 center">'+e.erro+"</p>"),sub&&(sub.unsubscribe(),isSubscribed=!1)):($("#notify").append('<p class="erro mt-2 center">Erro desconhecido!</p>'),sub&&(sub.unsubscribe(),isSubscribed=!1)),updateBtn();void 0!==typeof e.success&&e.success&&createCookie("no_update",1,10)}"serviceWorker"in navigator&&"PushManager"in window?navigator.serviceWorker.register("/sw.js").then((e=>{swRegistration=e,initializeUI()})):(btn.html("Notificações não suportadas"),$("#notify-unsupport").removeClass("d-none"));
