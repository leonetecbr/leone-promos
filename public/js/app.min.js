function igShare(e){const t=$(e).find(".product-title").html(),o=$(e).find(".description").html(),n=$(e).find("del").html(),i=$(e).find(".discount").val();$("#product-title").html(t),$("#product-image").attr("src",$(e).find(".product-image").attr("src")),$("#product-image").attr("alt",t),void 0!==n?($("#product-price-from").html(n),$("#price-from").show()):$("#price-from").hide(),$("#installment").html($(e).find(".installment").html()),void 0!==o?($("#product-desc").html(o),$("#product-desc").show()):$("#product-desc").hide(),void 0!==i?$("#product-code").show():$("#product-code").hide(),$("#product-price-to").html($(e).find(".pricing-card-title").html()),$("#share-link").html(getUrl(e)),$("#ig-share").removeClass("d-none")}function getText(e){const t=$(e).find(".description").html();let o=$(e).find(".pricing-card-title").html();const n=$(e).find("del").html();return"Grátis"!==o&&(o=`Por apenas: ${o}`),void 0!==n&&(o=`De: ${n}\n\n${o}`),o=`${$(e).find(".product-title").html()}.\n\n${o}!`,void 0!==t&&(o+=`\n\n${t}`),o}function getTextCupom(e){let t=$(e).find(".card-title").html()+" no(a) "+$(e).find(".loja-image").attr("alt");const o=$(e).find(".cupom-vigency").html();let n=String($(e).find(".discount").val()),i=n.substring(0,n.length-2);return n="Cupom: "+i.replace(/\w/g,"*")+n.substr(-2),t+=`\n\n${o}\n\n${n}`,t}function getUrl(e){return"https://para.promo/"+btoa(e.replace("#promo-","o-"))}function getUrlCupom(e){return"https://para.promo/"+btoa(e.replace("#cupom-","c-"))}function accept(){createCookie("accept","true",365),$("#aviso_cookie").fadeOut("slow")}function copyS(e){if(navigator.clipboard)navigator.clipboard.writeText(e);else{let t=document.createElement("textarea");e=document.createTextNode(e),t.id="text-copy",t.appendChild(e),$("#noeye").html(t),$("#text-copy").select(),document.execCommand("copy"),$("#noeye").html("")}$("#copy-success").removeClass("d-none"),setTimeout((()=>$("#copy-success").addClass("d-none")),3e3)}function copy(e,t){if(navigator.clipboard){const e=$(t).val();navigator.clipboard.writeText(e)}else $(t).attr("disabled",!1),$(t).select(),document.execCommand("copy"),$(t).attr("disabled",!0);window.open(e)}function submit(e){let t=getCSRF();$("#checkbox").append(t),$("#checkbox").trigger("submit")}function getCSRF(){let e=document.createElement("input");return e.setAttribute("type","hidden"),e.id="token",e.setAttribute("name","_token"),e.value=CSRF,e}function getReCaptcha(e){let t=document.createElement("input");return t.setAttribute("type","hidden"),t.id="g-recaptcha-response",t.setAttribute("name","g-recaptcha-response"),t.value=e,t}function createCookie(e,t,o){let n;if(o){let e=new Date;e.setTime(e.getTime()+24*o*60*60*1e3),n="; expires="+e.toGMTString()}else n="";document.cookie=`${e}=${t}${n}; path=/`}function getPrefer(e){$.ajax({url:"/prefer/get",data:JSON.stringify({endpoint:e,_token:CSRF}),dataType:"json",contentType:"application/json",type:"POST"}).done((e=>{if(e.success){let t=0;for(let o=0;o<e.pref.length;o++)e.pref[o]&&($("#p"+(o+1)).attr("checked",!0),t++);t==e.pref.length&&$("#all").attr("checked",!0),$("#preferencias").removeClass("d-none")}else null!=typeof e.message?alert(e.message):alert("Falha")})).fail((()=>{alert("Falha")}))}function redirectUrl(){let e=$("#url").val();e=e.strstr("?"),window.open(`/redirect?url=${e}`),$("#url").val("")}function pesquisar(e,t){let o=getCSRF(),n=getReCaptcha(t),i=document.createElement("form");i.setAttribute("method","POST"),i.setAttribute("action",`/search/${e}`),i.id="pesquisar",i.appendChild(o),i.appendChild(n),$("body").append(i),$("#pesquisar").trigger("submit")}function paginateSearch(e,t){let o=getCSRF(),n=getReCaptcha(t),i=document.createElement("form");i.setAttribute("method","POST"),i.setAttribute("action",`${e}`),i.id="pesquisar",i.appendChild(o),i.appendChild(n),$("body").append(i),$("#pesquisar").trigger("submit")}function getToken(e,t,o="ajax"){grecaptcha.ready((()=>{grecaptcha.execute(KEY_V3_RECAPTCHA,{action:e}).then((e=>{"ajax"==o?sendForm(t,e):"search"==o?pesquisar(t,e):"paginate"==o&&paginateSearch(t,e)}))}))}String.prototype.strstr=function(e){let t=this.indexOf(e);return-1==t?this:this.substring(0,t)},$((function(){$(".ajax-form").on("submit",(function(e){this.checkValidity()?(e.preventDefault(),getToken("form-"+this.id,this)):(e.preventDefault(),e.stopPropagation()),this.classList.add("was-validated")})),$(".needs-validation").on("submit",(function(e){if(!1===this.checkValidity())e.preventDefault(),e.stopPropagation(),$(this).addClass("was-validated");else{if(e.preventDefault(),$(this).addClass("was-validated"),"deeplink"==this.id)redirectUrl();else if("search"==this.id){getToken("search",$("#q").val(),"search")}$(this).removeClass("was-validated")}})),navigator.share&&$(".plus-share").removeClass("d-none"),$(".igs").on("click",(function(){alert("Tire print e compartilhe nas suas storys, para fechar dê um duplo clique!"),igShare("#"+$(this).closest(".promo").attr("id"))})),$(".mre").on("click",(function(){let e,t,o;void 0!==$(this).closest(".promo").attr("id")?(t="#"+$(this).closest(".promo").attr("id"),e=getText(t)+"\n",o=getUrl(t)):(t="#"+$(this).closest(".cupom").attr("id"),e=getTextCupom(t)+"\n",o=getUrlCupom(t)),navigator.share({text:e,url:o})})),$(".cpy").on("click",(function(){let e,t,o;void 0!==$(this).closest(".promo").attr("id")?(t="#"+$(this).closest(".promo").attr("id"),e=getText(t),o=getUrl(t)):(t="#"+$(this).closest(".cupom").attr("id"),e=getTextCupom(t),o=getUrlCupom(t)),e+=`\n\n${o}`,copyS(e)})),$(".wpp").on("click",(function(){let e,t,o;void 0!==$(this).closest(".promo").attr("id")?(t="#"+$(this).closest(".promo").attr("id"),e=getText(t),o=getUrl(t)):(t="#"+$(this).closest(".cupom").attr("id"),e=getTextCupom(t),o=getUrlCupom(t)),e+=`\n\n${o}`,window.open("https://api.whatsapp.com/send?text="+encodeURIComponent(e))})),$(".tlg").on("click",(function(){let e,t,o;void 0!==$(this).closest(".promo").attr("id")?(t="#"+$(this).closest(".promo").attr("id"),e="\n"+getText(t),o=getUrl(t)):(t="#"+$(this).closest(".cupom").attr("id"),e="\n"+getTextCupom(t),o=getUrlCupom(t)),window.open("https://telegram.me/share/url?url="+encodeURIComponent(o)+"&text="+encodeURIComponent(e))})),$(".twt").on("click",(function(){let e,t,o;void 0!==$(this).closest(".promo").attr("id")?(t="#"+$(this).closest(".promo").attr("id"),e=getText(t)+"\n\n",o=getUrl(t)):(t="#"+$(this).closest(".cupom").attr("id"),e=getTextCupom(t)+"\n\n",o=getUrlCupom(t)),window.open("https://twitter.com/share?url="+encodeURIComponent(o)+"&text="+encodeURIComponent(e))})),$("#ig-share").on("dbclick",(function(){$(this).addClass("d-none")})),$(window).on("scroll",(function(){let e=$("#cabecalho");$(this).scrollTop()>90?(e.addClass("fixed-top"),e.addClass("shadow"),$("body").css("padding-top",90)):(e.removeClass("fixed-top"),e.removeClass("shadow"),$("body").css("padding-top",0))})),$(".ajax-form").on("submit",(function(e){e.preventDefault(),form=this,grecaptcha.ready((()=>{grecaptcha.execute(KEY_V3_RECAPTCHA,{action:"send_form"}).then((e=>{let t=new Object;for(let e of $(form).serializeArray())t[e.name]=e.value;t._token=CSRF,t["g-recaptcha-response"]=e;let o=form.id,n=$(`#${o}-submit`).html(),i=$(`#${o}-submit`),s=`#error-${o}`;i.attr("disabled",!0),i.html("Aguarde ..."),$.ajax({url:form.action,data:JSON.stringify(t),dataType:"json",contentType:"application/json",type:"POST"}).done((function(e){void 0===e.success||void 0===e.message?($(s).html('<p class="erro mt-1">Erro desconhecido :(</p>'),$(s).show("slow")):e.success?($(s).html('<p class="bolder">'+e.message+"</p>"),$(s).show("slow")):($(s).html('<p class="erro mt-1">'+e.message+"</p>"),$(s).show("slow"))})).fail((()=>{$(s).html('<p class="erro mt-1">Não foi possível enviar os dados, tente novamente!</p>'),$(s).show("slow")})).always((()=>{i.html(n),i.attr("disabled",!1)}))}))}))})),$("#inotify").on("click",(function(){$("#notify").addClass("d-none"),createCookie("no_notify",1,60)})),0==window.location.pathname.indexOf("/search")&&($(".page-link").on("click",(function(e){e.preventDefault(),getToken("paginate",$(this).attr("href"),"paginate")})),$(".filtros").on("click",(function(e){e.preventDefault(),getToken("paginate",$(this).attr("href"),"paginate")}))),$("#prefers input[type='checkbox']").on("change",(function(){$("#prefers input[type='checkbox']").is(":checked")?($("#para").attr("disabled",!0),$("#para").removeAttr("required")):($("#para").attr("disabled",!1),$("#para").attr("required"))})),$("#all").on("change",(function(){$(this).is(":checked")?$(".prefer").attr("checked",!0):$(".prefer").removeAttr("checked")}))}));let sub,isSubscribed=!1,swRegistration=null,btn=$("#btn-notify");function urlB64ToUint8Array(e){const t=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),o=window.atob(t),n=new Uint8Array(o.length);for(let e=0;e<o.length;++e)n[e]=o.charCodeAt(e);return n}function initializeUI(){document.cookie.indexOf("no_notify")<0&&$("#notify").removeClass("d-none"),btn.attr("disabled",!1),btn.on("click",(()=>{btn.attr("disabled",!0),btn.html("Aguarde ..."),isSubscribed?unsubscribeUser():subscribeUser()})),swRegistration.pushManager.getSubscription().then((e=>{sub=e,isSubscribed=!(null===e),isSubscribed&&"/notificacoes"==window.location.pathname&&(getPrefer(e.endpoint),$("#endpoint").val(e.endpoint)),updateBtn()}))}function updateBtn(){if("denied"===Notification.permission)return $("#btn-notify").html("Notificações bloqueadas"),$("#btn-notify").attr("disabled",!0),$("#notify-bloqued").removeClass("d-none"),void(sub&&update("remove"));btn.attr("disabled",!1),isSubscribed?(setTimeout((()=>{createCookie("no_notify",1,60),$("#notify").hide("slow")}),1e3),btn.html("Desativar notificações")):btn.html("Ativar notificações")}function subscribeUser(){const e=urlB64ToUint8Array(KEY_VAPID_PUBLIC);swRegistration.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:e}).then((e=>{sub=e,update("add")})).catch((()=>updateBtn()))}function unsubscribeUser(){sub?(sub.unsubscribe(),isSubscribed=!1,update("remove"),$("#preferencias").addClass("d-none")):updateBtn()}function update(e){grecaptcha.ready((()=>{grecaptcha.execute(KEY_V3_RECAPTCHA,{action:"notify"}).then((t=>{const o={subscription:sub,action:e,token:t,_token:CSRF};$.ajax({url:"/register",type:"POST",data:JSON.stringify(o),dataType:"json",contentType:"application/json",success:t=>{processResponse(t,e)}}).fail((()=>($("#notify").append('<p class="erro mt-2 center">Erro desconhecido!</p>'),sub&&(sub.unsubscribe(),isSubscribed=!1),updateBtn())))}))}))}function processResponse(e,t){return void 0===e.success?($("#notify").append('<p class="erro mt-2 center">Erro desconhecido!</p>'),sub&&(sub.unsubscribe(),isSubscribed=!1)):e.success&&"add"==t?isSubscribed=!0:e.success&&"remove"==t?isSubscribed=!1:void 0!==e.erro?($("#notify").append('<p class="erro mt-2 center">'+e.erro+"</p>"),sub&&(sub.unsubscribe(),isSubscribed=!1)):($("#notify").append('<p class="erro mt-2 center">Erro desconhecido!</p>'),sub&&(sub.unsubscribe(),isSubscribed=!1)),updateBtn()}"serviceWorker"in navigator&&"PushManager"in window?navigator.serviceWorker.register("/sw.js").then((e=>{swRegistration=e,initializeUI()})):(btn.html("Notificações não suportadas"),$("#notify-unsupport").removeClass("d-none"));
