let options={hour:"numeric",minute:"numeric",year:"numeric",month:"2-digit",day:"2-digit"};String.prototype.strstr=function(e){let t=this.indexOf(e);return-1==t?this:this.substring(0,t)},String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.substring(1).toLowerCase()};let rastreioSuccess=e=>{if(e.success){let t,n=`<h2 class="text-center">${e.rastreio.codObjeto}</h2>\n<div class="text-center small fw-light">${e.rastreio.tipoPostal}</div>`;if(0!==e.rastreio.eventos.length){t='<div class="list-group eventos col-12 col-lg-9 mx-auto mt-3">';let n=" active";for(let i of e.rastreio.eventos){let e=new Intl.DateTimeFormat("pt-BR",options).format(new Date(i.dtHrCriado));i.unidadeDestino&&0!==i.unidadeDestino.endereco.length&&(i.descricao=i.descricao.replace("- por favor aguarde","para "+i.unidadeDestino.tipo+" de "+i.unidadeDestino.endereco.cidade.capitalize()+" - "+i.unidadeDestino.endereco.uf)),i.detalhe||0===i.unidade.endereco.length?i.detalhe||0!==i.unidade.endereco.length||(i.detalhe=i.unidade.nome):i.detalhe=i.unidade.tipo+" de "+i.unidade.endereco.cidade.capitalize()+" - "+i.unidade.endereco.uf,t+=`<a href="#" class="list-group-item list-group-item-action${n}"><div class="evento d-flex w-100 justify-content-between">`,t+=`<h5 class="mb-1">${i.descricao}</h5><small>${e}</small>`,t+=`</div><p class="mb-1">${i.detalhe}</p></a>`,n=""}t+="</div>"}else t='<div class="alert alert-warning">Aguardando postagem do objeto.</div>';$("#rastreamento").html(n+t),window.location.href="#rastreamento"}else void 0!==e.message&&($("#error-rastreio").html('<div class="alert alert-danger">'+e.message+"</div>"),$("#error-rastreio").removeClass("d-none"))};function igShare(e){let t=$(e).find(".product-title").html(),n=$(e).find(".description").html(),i=$(e).find("del").html(),o=$(e).find(".code-text").val();$("#product-title").html(t),$("#product-image").attr("src",$(e).find(".product-image").attr("src")),$("#product-image").attr("alt",t),void 0!==i?($("#product-price-from").html(i),$("#price-from").show()):$("#price-from").hide(),$("#installment").html($(e).find(".installment").html()),void 0!==n?($("#product-desc").html(n),$("#product-desc").show()):$("#product-desc").hide(),void 0!==o?$("#product-code").show():$("#product-code").hide(),$("#product-price-to").html($(e).find(".pricing-card-title").html()),$("#share-link").html(getUrl(e)),$("#ig-share").removeClass("d-none")}function escondeCupom(e){return(e=String(e)).substring(0,e.length-2).replace(/./g,"*")+e.substring(e.length-2)}function getText(e){let t=$(e).find(".description").html(),n=$(e).find(".pricing-card-title").html(),i=$(e).find("del").html(),o=$(e).find(".product-title").html(),a=$(e).find(".code-text").val();return"Grátis"!==n&&(n=`Por apenas ${n}!`),void 0!==i&&(n=`De: ${i}\n\n${n}`),void 0!==a&&(n+="\n\nCupom: "+escondeCupom(a)),n=`${o}.\n\n${n}`,void 0!==t&&(n+=`\n\n${t}`),n}function getTextCupom(e){let t=$(e).find(".card-title").html()+" no(a) "+$(e).find(".loja-image").attr("alt"),n=$(e).find(".cupom-vigency").html(),i=$(e).find(".code-text").val();return i="Cupom: "+escondeCupom(i),t+=`\n\n${n}\n\n${i}`,t}function getUrl(e){return"https://para.promo/"+btoa(e.replace("#promo-","o-")).replace("=","")}function getUrlCupom(e){return"https://para.promo/"+btoa(e.replace("#cupom-","c-")).replace("=","")}function accept(){createCookie("accept","true",365),$("#aviso_cookie").fadeOut("slow")}function copyText(e,t=!1){navigator.clipboard.writeText(e).then((()=>{t?window.open(t):($("#copy-success").removeClass("d-none"),setTimeout((()=>$("#copy-success").addClass("d-none")),3e3))}),(()=>{alert("Não foi possível copiar, copie manualmente!"),t&&window.open(t)}))}function topo(){$("html, body").animate({scrollTop:0},800)}function submit(){let e=getCSRF();$("#checkbox").append(e),$("#checkbox").trigger("submit")}function getCSRF(){let e=document.createElement("input");return e.setAttribute("type","hidden"),e.id="token",e.setAttribute("name","_token"),e.value=CSRF,e}function getReCaptcha(e){let t=document.createElement("input");return t.setAttribute("type","hidden"),t.id="g-recaptcha-response",t.setAttribute("name","g-recaptcha-response"),t.value=e,t}function createCookie(e,t,n){let i;if(n){let e=new Date;e.setTime(e.getTime()+24*n*60*60*1e3),i="; expires="+e.toGMTString()}else i="";document.cookie=`${e}=${t}${i}; path=/`}function deleteCookie(e){createCookie(e,"",-1)}function getPrefer(e){$.ajax({url:"/prefer/get",data:JSON.stringify({endpoint:e,_token:CSRF}),dataType:"json",contentType:"application/json",type:"POST"}).done((e=>{if(e.success){let t=0;for(let n=0;n<e.pref.length;n++)e.pref[n]&&($("#p"+(n+1)).attr("checked",!0),t++);t==e.pref.length&&$("#all").attr("checked",!0),$("#preferencias").removeClass("d-none")}else null!=typeof e.message?alert(e.message):alert("Falha")})).fail((()=>{alert("Falha")}))}function redirectUrl(){let e=$("#url").val();e=e.strstr("?"),window.open(`/redirect?url=${e}`),$("#url").val("")}function pesquisar(e,t){let n=getCSRF(),i=getReCaptcha(t),o=document.createElement("form");o.setAttribute("method","POST"),o.setAttribute("action",`/search/${e}`),o.id="pesquisar",o.appendChild(n),o.appendChild(i),$("body").append(o),$("#pesquisar").trigger("submit")}function paginateSearch(e,t){let n=getCSRF(),i=getReCaptcha(t),o=document.createElement("form");o.setAttribute("method","POST"),o.setAttribute("action",`${e}`),o.id="pesquisar",o.appendChild(n),o.appendChild(i),$("body").append(o),$("#pesquisar").trigger("submit")}function sendForm(e,t,n){void 0===n&&(n=e=>{void 0===typeof e.success?($(s).html('<p class="alert alert-danger">Erro desconhecido :(</p>'),$(s).removeClass("d-none")):void 0!==typeof e.message&&(e.success?($(s).html('<div class="alert alert-success">'+e.message+"</div>"),$(s).removeClass("d-none")):($(s).html('<p class="alert alert-danger">'+e.message+"</p>"),$(s).removeClass("d-none")))});let i=new Object;for(let t of $(`#${e}`).serializeArray())i[t.name]=t.value;i._token=CSRF,i["g-recaptcha-response"]=t;let o=$(`#${e}-submit`).html(),a=$(`#${e}-submit`),s=`#error-${e}`;a.attr("disabled",!0),a.html("Aguarde ..."),$(`#${e}`).removeClass("was-validated"),$(s).addClass("d-none"),$.ajax({url:$(`#${e}`).attr("action"),data:JSON.stringify(i),dataType:"json",contentType:"application/json",type:"POST"}).done(n).fail((()=>{$(s).html('<p class="alert alert-danger">Não foi possível enviar os dados, tente novamente!</p>'),$(s).removeClass("d-none")})).always((()=>{a.html(o),a.attr("disabled",!1)}))}function getToken(e,t,n="ajax"){let i=$(`#${t}-submit`),o=i.html();i.html("Verificando ..."),i.attr("disabled",!0),grecaptcha.ready((()=>{grecaptcha.execute(KEY_V3_RECAPTCHA,{action:e}).then((e=>{if(i.html(o),"ajax"===n)sendForm(t,e);else if("search"===n){pesquisar($("#q").val(),e)}else"paginate"===n?paginateSearch(t,e):"rastreio"===n&&sendForm(t,e,rastreioSuccess)}))}))}function getData(e){let t,n,i;return void 0!==$(e).closest(".promo").attr("id")?(t="#"+$(e).closest(".promo").attr("id"),n=getText(t),i=getUrl(t)):(t="#"+$(e).closest(".cupom").attr("id"),n="\n"+getTextCupom(t),i=getUrlCupom(t)),{url:i,text:n}}$((function(){$(".ajax-form").on("submit",(function(e){this.checkValidity()?(e.preventDefault(),getToken($(this).attr("data-action"),this.id)):(e.preventDefault(),e.stopPropagation()),this.classList.add("was-validated")})),$(".needs-validation").on("submit",(function(e){!1===this.checkValidity()?(e.preventDefault(),e.stopPropagation(),$(this).addClass("was-validated")):(e.preventDefault(),$(this).addClass("was-validated"),"deeplink"==this.id?redirectUrl():"rastreio"===this.id&&getToken("rastrear",this.id,"rastreio"),$(this).removeClass("was-validated"))})),navigator.share&&$(".plus-share").removeClass("d-none"),$(".igs").on("click",(function(){alert("Tire print e compartilhe nas suas storys, para fechar dê um duplo clique!"),igShare("#"+$(this).closest(".promo").attr("id"))})),$(".mre").on("click",(function(){let{text:e,url:t}=getData(this);navigator.share({text:e,url:t})})),$(".cpy").on("click",(function(){let{text:e,url:t}=getData(this);e+=`\n\n${t}`,copyText(e)})),$(".wpp").on("click",(function(){let{text:e,url:t}=getData(this);e+=`\n\n${t}`,window.open("https://api.whatsapp.com/send?text="+encodeURIComponent(e))})),$(".tlg").on("click",(function(){let{text:e,url:t}=getData(this);window.open("https://telegram.me/share/url?url="+encodeURIComponent(t)+"&text="+encodeURIComponent(e))})),$(".twt").on("click",(function(){let{text:e,url:t}=getData(this);e+="\n",window.open("https://twitter.com/share?url="+encodeURIComponent(t)+"&text="+encodeURIComponent(e))})),$("#ig-share").on("dbclick",(function(){$(this).addClass("d-none")})),$(".copy-redirect").on("click",(function(){let e=$(this).closest(".promo").attr("id");e=void 0===e?"#"+$(this).closest(".cupom").attr("id"):"#"+e;let t=$(this).attr("data-link");copyText($(e).find(".code-text").val(),t)})),$(window).on("scroll",(function(){let e=$("#cabecalho");$(this).scrollTop()>90?(e.addClass("fixed-top"),e.addClass("shadow"),$("body").addClass("pt-5")):(e.removeClass("fixed-top"),e.removeClass("shadow"),$("body").removeClass("pt-5"))})),$("#inotify").on("click",(function(){$("#notify").addClass("d-none"),createCookie("no_notify",1,60)})),0==window.location.pathname.indexOf("/search")&&($(".page-link").on("click",(function(e){e.preventDefault(),getToken("paginate",$(this).attr("href"),"paginate")})),$(".filtros").on("click",(function(e){e.preventDefault(),getToken("paginate",$(this).attr("href"),"paginate")}))),$("#prefers input[type='checkbox']").on("change",(function(){$("#prefers input[type='checkbox']").is(":checked")?($("#para").attr("disabled",!0),$("#para").removeAttr("required")):($("#para").attr("disabled",!1),$("#para").attr("required"))})),$("#all").on("change",(function(){$(".prefer").prop("checked",$(this).is(":checked"))})),$("#notificacao").on("change",(function(){$(this).is(":checked")?($("#prefers").removeClass("d-none"),$("#prefers").addClass("d-md-flex")):($("#prefers").addClass("d-none"),$("#prefers").removeClass("d-md-flex"),$(".prefer").prop("checked",!0))})),$(".prefer").on("change",(function(){let e=!0;for(check of $(".prefer"))$(check).is(":checked")||(e=!1);$("#all").prop("checked",e)})),$("#btn-topo").on("click",topo)}));let sub,isSubscribed=!1,swRegistration=null,btn=$("#btn-notify");function urlB64ToUint8Array(e){const t=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),n=window.atob(t),i=new Uint8Array(n.length);for(let e=0;e<n.length;++e)i[e]=n.charCodeAt(e);return i}function initializeUI(){document.cookie.indexOf("no_notify")<0&&$("#notify").removeClass("d-none"),btn.attr("disabled",!1),btn.on("click",(()=>{btn.attr("disabled",!0),btn.html("Aguarde ..."),isSubscribed?unsubscribeUser():subscribeUser()})),swRegistration.pushManager.getSubscription().then((e=>{if(sub=e,isSubscribed=!(null===e),isSubscribed)"/notificacoes"===window.location.pathname?(getPrefer(e.endpoint),$("#endpoint").val(e.endpoint)):"/"===window.location.pathname&&document.cookie.indexOf("no_update")<0&&update("update");else if("granted"===Notification.permission&&document.cookie.indexOf("no_resubscribe")<0){const e=urlB64ToUint8Array(KEY_VAPID_PUBLIC);swRegistration.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:e}).then((e=>{sub=e,update("update")})).catch((()=>console.log("Falha na reativação das notificações")))}updateBtn()}))}function updateBtn(){if("denied"===Notification.permission)return $("#btn-notify").html("Notificações bloqueadas"),$("#btn-notify").attr("disabled",!0),$("#notify-bloqued").removeClass("d-none"),void(sub&&update("remove"));btn.attr("disabled",!1),isSubscribed?(setTimeout((()=>{createCookie("no_notify",1,60),$("#notify").hide("slow")}),1e3),btn.html("Desativar notificações")):btn.html("Ativar notificações")}function subscribeUser(){deleteCookie("no_resubscribe");const e=urlB64ToUint8Array(KEY_VAPID_PUBLIC);swRegistration.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:e}).then((e=>{sub=e,update("add")})).catch((()=>updateBtn()))}function unsubscribeUser(){createCookie("no_resubscribe",1,365),sub?(sub.unsubscribe(),isSubscribed=!1,update("remove"),$("#preferencias").addClass("d-none")):updateBtn()}function update(e){grecaptcha.ready((()=>{grecaptcha.execute(KEY_V3_RECAPTCHA,{action:"notify"}).then((t=>{const n={subscription:sub,action:e,token:t,_token:CSRF};$.ajax({url:"/notificacoes/manage",type:"POST",data:JSON.stringify(n),dataType:"json",contentType:"application/json",success:t=>{processResponse(t,e)}}).fail((()=>($("#notify").append('<p class="erro mt-2 center">Erro desconhecido!</p>'),sub&&(sub.unsubscribe(),isSubscribed=!1),updateBtn())))}))}))}function processResponse(e,t){if("update"!==t)return void 0===typeof e.success?($("#notify").append('<p class="erro mt-2 center">Erro desconhecido!</p>'),sub&&(sub.unsubscribe(),isSubscribed=!1)):e.success&&"add"===t?isSubscribed=!0:e.success&&"remove"===t?isSubscribed=!1:void 0!==typeof e.erro?($("#notify").append('<p class="erro mt-2 center">'+e.erro+"</p>"),sub&&(sub.unsubscribe(),isSubscribed=!1)):($("#notify").append('<p class="erro mt-2 center">Erro desconhecido!</p>'),sub&&(sub.unsubscribe(),isSubscribed=!1)),updateBtn();void 0!==typeof e.success&&e.success&&createCookie("no_update",1,10)}"serviceWorker"in navigator&&"PushManager"in window?navigator.serviceWorker.register("/sw.js").then((e=>{swRegistration=e,initializeUI()})):(btn.html("Notificações não suportadas"),$("#notify-unsupport").removeClass("d-none"));
